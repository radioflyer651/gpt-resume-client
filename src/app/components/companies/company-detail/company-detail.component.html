<div *ngIf="!(editTarget)">
    Loading...
</div>

<div *ngIf="editTarget">
    <h5>
        Company Info
    </h5>
    <p-floatlabel>
        <input id="company-name" pInputText [(ngModel)]="editTarget.name" />
        <label for="company-name">Company name</label>
    </p-floatlabel>
    <p-floatlabel>
        <input id="website" pInputText [(ngModel)]="editTarget.website" />
        <label for="website">Website</label>
    </p-floatlabel>

    <h5 class="contacts">
        Contacts
    </h5>

    <ng-container *ngIf="(!isNewCompany && contacts); else saveCompanyFirst">
        <p-table [value]="contacts">
            <ng-template #header>
                <tr>
                    <th>
                        Name
                    </th>
                    <th>
                        Title
                    </th>
                    <th>
                        Email
                    </th>
                    <th>
                        Actions
                    </th>
                </tr>
            </ng-template>

            <ng-template #body let-contact>
                <td>
                    {{contact.firstName}} {{contact.lastName}}
                </td>
                <td>
                    {{contact.title}}
                </td>
                <td>
                    <a href="mailto:{{contact.email}}">{{contact.email}}</a>
                </td>
                <td class="control-cell">
                    <p-button icon="pi pi-cog" (click)="editContact(contact._id)"></p-button>
                    <p-button icon="pi pi-times"></p-button>
                </td>
            </ng-template>
        </p-table>

        <div class="toolbar-container">
            <p-toolbar>
                <ng-template #start>

                </ng-template>

                <ng-template #end>
                    <p-button icon="pi pi-plus" (click)="editContact('new')"></p-button>
                </ng-template>
            </p-toolbar>
        </div>

    </ng-container>

    <h5 class="openings">
        Job Openings
    </h5>

    <ng-container *ngIf="(!isNewCompany && jobListings); else saveCompanyFirst">
        <p-table [value]="jobListings">
            <ng-template #header>
                <tr>
                    <th>
                        Posting Date
                    </th>
                    <th>
                        Title
                    </th>
                    <th>
                        Posting Link
                    </th>
                    <th>
                        Status
                    </th>
                </tr>
            </ng-template>

            <ng-template #body let-listing>
                <tr>
                    <td>
                        {{ listing.postingDate | date:'MM/dd/yy' }}
                    </td>
                    <td>
                        {{listing.jobTitle}}
                    </td>
                    <td>
                        <a href="{{listing.urlLink}}" target="_blank"> {{listing.urlLink}} </a>
                    </td>
                    <td>
                        <div *ngIf="listing.currentStatus">
                            <div>
                                {{listing.currentStatus.status}}
                            </div>
                            <div>
                                {{listing.currentStatus.statusDate | date:'MM/dd/yy'}}
                            </div>
                        </div>
                    </td>
                </tr>
            </ng-template>
        </p-table>

        <div class="toolbar-container">
            <p-toolbar>
                <ng-template #start>

                </ng-template>

                <ng-template #end>
                    <p-button icon="pi pi-plus"></p-button>
                </ng-template>
            </p-toolbar>
        </div>

    </ng-container>

    <ng-template #saveCompanyFirst>
        <div>
            Contacts can be added once the company is saved.
        </div>
    </ng-template>
</div>

<app-contact-dialog [(visible)]="isNewContactVisible" [contactId]="editContactTargetId"
    [companyId]="(companyId$ | async)!" (onComplete)="onNewContactClosed($event)"></app-contact-dialog>